<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PPL Program â€” 12 Weeks</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0a;
    --surface: #141414;
    --surface2: #1e1e1e;
    --border: #2a2a2a;
    --accent: #e8ff3a;
    --accent2: #ff4d4d;
    --accent3: #3ae8ff;
    --text: #f0f0f0;
    --muted: #666;
    --push: #ff6b35;
    --pull: #3ae8ff;
    --legs: #a855f7;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; overflow: hidden; }

  #app { height: 100vh; display: flex; flex-direction: column; }

  /* HEADER */
  .header {
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    padding: 14px 20px 10px;
    flex-shrink: 0;
    display: flex; align-items: center; justify-content: space-between;
  }
  .header-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 2px; color: var(--accent); }
  .week-badge {
    background: var(--accent); color: #000; font-size: 11px; font-weight: 700;
    padding: 3px 10px; border-radius: 20px; letter-spacing: 1px; text-transform: uppercase;
  }

  /* SCREENS */
  .screen { flex: 1; overflow-y: auto; display: none; }
  .screen.active { display: block; }

  /* BOTTOM NAV */
  .bottom-nav {
    display: flex; background: var(--surface); border-top: 1px solid var(--border);
    flex-shrink: 0;
  }
  .nav-btn {
    flex: 1; padding: 10px 4px; text-align: center; cursor: pointer;
    transition: all 0.2s; border: none; background: none; color: var(--muted);
    font-family: 'DM Sans', sans-serif;
  }
  .nav-btn.active { color: var(--accent); }
  .nav-btn svg { display: block; margin: 0 auto 3px; }
  .nav-btn span { font-size: 10px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; }

  /* DASHBOARD */
  .dashboard { padding: 20px; }

  .program-bar {
    background: var(--surface); border: 1px solid var(--border); border-radius: 16px;
    padding: 18px; margin-bottom: 16px;
  }
  .pb-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 6px; }
  .pb-progress { height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; margin-top: 10px; }
  .pb-bar { height: 100%; background: var(--accent); border-radius: 3px; transition: width 0.6s ease; }
  .pb-stats { display: flex; gap: 20px; margin-top: 14px; }
  .pb-stat { }
  .pb-stat-val { font-family: 'Bebas Neue', sans-serif; font-size: 28px; color: var(--accent); }
  .pb-stat-lbl { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }

  .section-title {
    font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: var(--muted);
    margin-bottom: 12px; margin-top: 20px;
  }

  .today-card {
    background: var(--surface); border-radius: 16px; padding: 20px;
    border: 1px solid var(--border); margin-bottom: 16px; cursor: pointer;
    transition: transform 0.15s, border-color 0.15s;
    position: relative; overflow: hidden;
  }
  .today-card:active { transform: scale(0.98); }
  .today-card::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
  }
  .today-card.push::before { background: var(--push); }
  .today-card.pull::before { background: var(--pull); }
  .today-card.legs::before { background: var(--legs); }
  .today-card.rest::before { background: var(--muted); }

  .tc-type {
    font-family: 'Bebas Neue', sans-serif; font-size: 13px; letter-spacing: 3px;
    margin-bottom: 4px;
  }
  .tc-type.push { color: var(--push); }
  .tc-type.pull { color: var(--pull); }
  .tc-type.legs { color: var(--legs); }
  .tc-type.rest { color: var(--muted); }

  .tc-name { font-size: 22px; font-weight: 600; margin-bottom: 8px; }
  .tc-meta { font-size: 13px; color: var(--muted); }
  .tc-btn {
    margin-top: 14px; background: var(--accent); color: #000; border: none;
    padding: 10px 24px; border-radius: 30px; font-family: 'DM Sans', sans-serif;
    font-size: 13px; font-weight: 700; cursor: pointer; letter-spacing: 0.5px;
  }
  .tc-btn.rest-btn { background: var(--surface2); color: var(--muted); }

  .week-strip { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 4px; }
  .week-strip::-webkit-scrollbar { display: none; }
  .week-dot {
    flex-shrink: 0; width: 36px; height: 36px; border-radius: 10px;
    background: var(--surface); border: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s;
    color: var(--muted);
  }
  .week-dot.current { border-color: var(--accent); color: var(--accent); }
  .week-dot.done { background: var(--accent); color: #000; border-color: var(--accent); }
  .week-dot.partial { border-color: var(--push); color: var(--push); }

  /* WORKOUT SCREEN */
  .workout-screen { padding: 20px; }
  .ws-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
  .ws-back { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
  .ws-type-badge { font-family: 'Bebas Neue', sans-serif; font-size: 12px; letter-spacing: 3px; padding: 4px 12px; border-radius: 20px; }
  .ws-type-badge.push { background: rgba(255,107,53,0.2); color: var(--push); }
  .ws-type-badge.pull { background: rgba(58,232,255,0.2); color: var(--pull); }
  .ws-type-badge.legs { background: rgba(168,85,247,0.2); color: var(--legs); }
  .ws-title { font-size: 24px; font-weight: 700; }

  .exercise-card {
    background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
    padding: 16px; margin-bottom: 12px;
  }
  .ex-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
  .ex-name { font-size: 16px; font-weight: 600; }
  .ex-num { font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--border); }
  .ex-desc { font-size: 12px; color: var(--muted); margin-bottom: 14px; line-height: 1.5; }

  .sets-grid { display: grid; grid-template-columns: 30px 1fr 1fr 44px; gap: 6px; align-items: center; }
  .sets-grid-header { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 4px; }
  .set-num { font-size: 12px; color: var(--muted); font-weight: 600; }
  .set-input {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 8px;
    color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px; font-weight: 500;
    padding: 8px 10px; width: 100%; text-align: center; outline: none;
    transition: border-color 0.2s;
  }
  .set-input:focus { border-color: var(--accent); }
  .set-check {
    width: 36px; height: 36px; border-radius: 8px; border: 1.5px solid var(--border);
    background: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: all 0.2s; flex-shrink: 0;
  }
  .set-check.done { background: var(--accent); border-color: var(--accent); }
  .set-check.done svg { stroke: #000; }
  .set-check svg { stroke: var(--muted); }

  .finish-btn {
    width: 100%; padding: 16px; background: var(--accent); color: #000; border: none;
    border-radius: 14px; font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 3px;
    cursor: pointer; margin-top: 20px; margin-bottom: 30px; transition: opacity 0.2s;
  }
  .finish-btn:active { opacity: 0.85; }

  /* SCHEDULE SCREEN */
  .schedule-screen { padding: 20px; }
  .phase-section { margin-bottom: 28px; }
  .phase-title {
    font-family: 'Bebas Neue', sans-serif; font-size: 18px; letter-spacing: 3px;
    color: var(--muted); margin-bottom: 12px; padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
  }
  .phase-title span { color: var(--accent); }
  .week-row {
    background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
    padding: 12px 16px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s;
    display: flex; align-items: center; justify-content: space-between;
  }
  .week-row:active { transform: scale(0.98); }
  .week-row.current { border-color: var(--accent); }
  .week-row.completed { opacity: 0.5; }
  .wr-left { }
  .wr-num { font-family: 'Bebas Neue', sans-serif; font-size: 16px; letter-spacing: 2px; color: var(--muted); }
  .wr-focus { font-size: 14px; font-weight: 500; }
  .wr-right { display: flex; gap: 4px; }
  .day-pip { width: 8px; height: 8px; border-radius: 50%; background: var(--border); }
  .day-pip.push { background: var(--push); }
  .day-pip.pull { background: var(--pull); }
  .day-pip.legs { background: var(--legs); }
  .day-pip.done { background: var(--accent); }

  /* PROGRESS SCREEN */
  .progress-screen { padding: 20px; }
  .stat-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 18px; }
  .sc-val { font-family: 'Bebas Neue', sans-serif; font-size: 36px; }
  .sc-val.accent { color: var(--accent); }
  .sc-val.push { color: var(--push); }
  .sc-val.pull { color: var(--pull); }
  .sc-val.legs { color: var(--legs); }
  .sc-lbl { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-top: 2px; }

  .muscle-breakdown { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 18px; margin-bottom: 12px; }
  .mb-title { font-size: 13px; font-weight: 600; margin-bottom: 14px; }
  .mb-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  .mb-label { font-size: 12px; color: var(--muted); width: 80px; flex-shrink: 0; }
  .mb-bar-wrap { flex: 1; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
  .mb-bar-fill { height: 100%; border-radius: 3px; transition: width 0.8s ease; }
  .mb-count { font-size: 11px; color: var(--muted); width: 20px; text-align: right; flex-shrink: 0; }

  .reset-btn {
    width: 100%; padding: 12px; background: transparent; color: var(--accent2);
    border: 1px solid var(--accent2); border-radius: 12px; font-family: 'DM Sans', sans-serif;
    font-size: 14px; font-weight: 600; cursor: pointer; margin-top: 10px; margin-bottom: 30px;
  }

  /* Completion Modal */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100;
    display: none; align-items: center; justify-content: center; padding: 20px;
  }
  .modal-overlay.show { display: flex; }
  .modal {
    background: var(--surface); border: 1px solid var(--border); border-radius: 20px;
    padding: 30px; width: 100%; max-width: 340px; text-align: center;
  }
  .modal-icon { font-size: 48px; margin-bottom: 16px; }
  .modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; letter-spacing: 2px; color: var(--accent); margin-bottom: 8px; }
  .modal-text { font-size: 14px; color: var(--muted); line-height: 1.6; margin-bottom: 24px; }
  .modal-btn { background: var(--accent); color: #000; border: none; padding: 12px 32px; border-radius: 30px; font-family: 'DM Sans', sans-serif; font-weight: 700; font-size: 15px; cursor: pointer; width: 100%; }

  .timer-display {
    background: var(--surface2); border-radius: 10px; padding: 10px 16px;
    display: flex; align-items: center; gap: 10px; margin-bottom: 16px;
  }
  .timer-val { font-family: 'Bebas Neue', sans-serif; font-size: 22px; color: var(--accent); }
  .timer-lbl { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
  .timer-reset { margin-left: auto; background: var(--border); border: none; color: var(--muted); border-radius: 6px; padding: 4px 10px; font-size: 11px; cursor: pointer; font-family: 'DM Sans', sans-serif; }
</style>
</head>
<body>
<div id="app">
  <div class="header">
    <span class="header-title">IRON PPL</span>
    <span class="week-badge" id="header-week">WEEK 1</span>
  </div>

  <!-- DASHBOARD -->
  <div class="screen active" id="screen-dashboard">
    <div class="dashboard">
      <div class="program-bar">
        <div class="pb-label">12-Week Program Progress</div>
        <div class="pb-progress"><div class="pb-bar" id="prog-bar" style="width:0%"></div></div>
        <div class="pb-stats">
          <div class="pb-stat">
            <div class="pb-stat-val" id="stat-workouts">0</div>
            <div class="pb-stat-lbl">Workouts</div>
          </div>
          <div class="pb-stat">
            <div class="pb-stat-val" id="stat-week">1</div>
            <div class="pb-stat-lbl">Current Week</div>
          </div>
          <div class="pb-stat">
            <div class="pb-stat-val" id="stat-streak">0</div>
            <div class="pb-stat-lbl">Day Streak</div>
          </div>
        </div>
      </div>

      <div class="section-title">Today's Workout</div>
      <div id="today-card-container"></div>

      <div class="section-title">Weekly Overview</div>
      <div class="week-strip" id="week-strip"></div>
    </div>
  </div>

  <!-- WORKOUT -->
  <div class="screen" id="screen-workout">
    <div class="workout-screen">
      <div class="ws-header">
        <div class="ws-back" onclick="showDashboard()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
        </div>
        <div>
          <div id="workout-badge" class="ws-type-badge push">PUSH</div>
          <div id="workout-title" class="ws-title">Upper Push</div>
        </div>
      </div>

      <div class="timer-display">
        <div>
          <div class="timer-lbl">Workout Time</div>
          <div class="timer-val" id="timer-display">0:00</div>
        </div>
        <button class="timer-reset" onclick="resetTimer()">Reset</button>
      </div>

      <div id="exercise-list"></div>
      <button class="finish-btn" onclick="finishWorkout()">FINISH WORKOUT</button>
    </div>
  </div>

  <!-- SCHEDULE -->
  <div class="screen" id="screen-schedule">
    <div class="schedule-screen">
      <div class="section-title" style="margin-top:4px">12-Week Schedule</div>
      <div id="schedule-list"></div>
    </div>
  </div>

  <!-- PROGRESS -->
  <div class="screen" id="screen-progress">
    <div class="progress-screen">
      <div class="section-title" style="margin-top:4px">Your Stats</div>
      <div class="stat-row">
        <div class="stat-card"><div class="sc-val accent" id="p-total">0</div><div class="sc-lbl">Total Workouts</div></div>
        <div class="stat-card"><div class="sc-val accent" id="p-week">W1</div><div class="sc-lbl">Current Week</div></div>
      </div>
      <div class="stat-row">
        <div class="stat-card"><div class="sc-val push" id="p-push">0</div><div class="sc-lbl">Push Days</div></div>
        <div class="stat-card"><div class="sc-val pull" id="p-pull">0</div><div class="sc-lbl">Pull Days</div></div>
      </div>
      <div class="stat-row">
        <div class="stat-card"><div class="sc-val legs" id="p-legs">0</div><div class="sc-lbl">Leg Days</div></div>
        <div class="stat-card"><div class="sc-val accent" id="p-streak">0</div><div class="sc-lbl">Best Streak</div></div>
      </div>

      <div class="muscle-breakdown">
        <div class="mb-title">Volume Distribution</div>
        <div class="mb-row">
          <div class="mb-label">Chest</div>
          <div class="mb-bar-wrap"><div class="mb-bar-fill" style="width:85%; background:var(--push)"></div></div>
          <div class="mb-count">3x</div>
        </div>
        <div class="mb-row">
          <div class="mb-label">Shoulders</div>
          <div class="mb-bar-wrap"><div class="mb-bar-fill" style="width:70%; background:var(--push)"></div></div>
          <div class="mb-count">2x</div>
        </div>
        <div class="mb-row">
          <div class="mb-label">Triceps</div>
          <div class="mb-bar-wrap"><div class="mb-bar-fill" style="width:75%; background:var(--push)"></div></div>
          <div class="mb-count">2x</div>
        </div>
        <div class="mb-row">
          <div class="mb-label">Back</div>
          <div class="mb-bar-wrap"><div class="mb-bar-fill" style="width:90%; background:var(--pull)"></div></div>
          <div class="mb-count">3x</div>
        </div>
        <div class="mb-row">
          <div class="mb-label">Biceps</div>
          <div class="mb-bar-wrap"><div class="mb-bar-fill" style="width:60%; background:var(--pull)"></div></div>
          <div class="mb-count">2x</div>
        </div>
        <div class="mb-row">
          <div class="mb-label">Quads</div>
          <div class="mb-bar-wrap"><div class="mb-bar-fill" style="width:85%; background:var(--legs)"></div></div>
          <div class="mb-count">2x</div>
        </div>
        <div class="mb-row">
          <div class="mb-label">Hamstrings</div>
          <div class="mb-bar-wrap"><div class="mb-bar-fill" style="width:70%; background:var(--legs)"></div></div>
          <div class="mb-count">2x</div>
        </div>
      </div>

      <button class="reset-btn" onclick="confirmReset()">Reset All Progress</button>
    </div>
  </div>

  <nav class="bottom-nav">
    <button class="nav-btn active" onclick="switchTab('dashboard', this)" id="tab-dashboard">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      <span>Home</span>
    </button>
    <button class="nav-btn" onclick="switchTab('schedule', this)" id="tab-schedule">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
      <span>Schedule</span>
    </button>
    <button class="nav-btn" onclick="switchTab('progress', this)" id="tab-progress">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
      <span>Progress</span>
    </button>
  </nav>
</div>

<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <div class="modal-icon" id="modal-icon">ðŸ”¥</div>
    <div class="modal-title" id="modal-title">WORKOUT DONE!</div>
    <div class="modal-text" id="modal-text">Great work! Keep it up.</div>
    <button class="modal-btn" id="modal-btn" onclick="closeModal()">Continue</button>
  </div>
</div>

<script>
// ============================================================
// DATA
// ============================================================
const PHASES = [
  { name: 'Foundation', weeks: [1,2,3,4], focus: 'Build base strength & form', rpe: '6-7' },
  { name: 'Hypertrophy', weeks: [5,6,7,8], focus: 'Volume & muscle growth', rpe: '7-8' },
  { name: 'Intensification', weeks: [9,10,11,12], focus: 'Heavy loads & peak strength', rpe: '8-9' },
];

// Sets/reps by phase
function getSetsReps(dayType, phase) {
  const configs = {
    push: [
      { sets:3, reps:'8-12', note:'Focus on full range of motion' },
      { sets:4, reps:'8-12', note:'Progressive overload each week' },
      { sets:4, reps:'6-10', note:'Heavier loads this phase' },
    ],
    pull: [
      { sets:3, reps:'8-12', note:'Squeeze at top of each rep' },
      { sets:4, reps:'8-12', note:'Add weight when you hit top of range' },
      { sets:4, reps:'5-8', note:'Maximum effort sets' },
    ],
    legs: [
      { sets:3, reps:'10-15', note:'Control the eccentric' },
      { sets:4, reps:'8-12', note:'Increase intensity this phase' },
      { sets:4, reps:'6-10', note:'Push to near failure' },
    ],
  };
  return configs[dayType][phase];
}

const EXERCISES = {
  push: [
    { name: 'Barbell Bench Press', muscle: 'Chest' },
    { name: 'Incline Dumbbell Press', muscle: 'Upper Chest' },
    { name: 'Seated Dumbbell OHP', muscle: 'Shoulders' },
    { name: 'Lateral Raises', muscle: 'Side Delts' },
    { name: 'Cable Flyes', muscle: 'Chest' },
    { name: 'Tricep Pushdowns', muscle: 'Triceps' },
    { name: 'Overhead Tricep Extension', muscle: 'Triceps' },
  ],
  pull: [
    { name: 'Barbell Deadlift', muscle: 'Back / Hamstrings' },
    { name: 'Pull-Ups / Lat Pulldown', muscle: 'Lats' },
    { name: 'Barbell Rows', muscle: 'Mid Back' },
    { name: 'Seated Cable Row', muscle: 'Rhomboids' },
    { name: 'Face Pulls', muscle: 'Rear Delts' },
    { name: 'Barbell Curls', muscle: 'Biceps' },
    { name: 'Hammer Curls', muscle: 'Brachialis' },
  ],
  legs: [
    { name: 'Barbell Back Squat', muscle: 'Quads / Glutes' },
    { name: 'Romanian Deadlift', muscle: 'Hamstrings' },
    { name: 'Leg Press', muscle: 'Quads' },
    { name: 'Walking Lunges', muscle: 'Glutes / Quads' },
    { name: 'Leg Curl', muscle: 'Hamstrings' },
    { name: 'Calf Raises', muscle: 'Calves' },
    { name: 'Leg Extension', muscle: 'Quads' },
  ],
};

// Day pattern (6 days on, 1 rest = Sun)
// Mon=Push, Tue=Pull, Wed=Legs, Thu=Push, Fri=Pull, Sat=Legs, Sun=Rest
const DAY_PATTERN = ['push','pull','legs','push','pull','legs','rest'];

// ============================================================
// STATE
// ============================================================
let state = JSON.parse(localStorage.getItem('ppl_state') || 'null') || {
  startDate: new Date().toISOString().split('T')[0],
  completedDays: {}, // key: "week-dayOfWeek" => true
  currentWeek: 1,
  streak: 0,
  lastWorkoutDate: null,
};

function saveState() { localStorage.setItem('ppl_state', JSON.stringify(state)); }

function getProgramDay() {
  const start = new Date(state.startDate);
  const now = new Date();
  const diff = Math.floor((now - start) / 86400000);
  return diff % 84; // 12 weeks * 7 days
}

function getCurrentWeek() {
  return Math.min(12, state.currentWeek);
}

function getPhase(week) {
  if (week <= 4) return 0;
  if (week <= 8) return 1;
  return 2;
}

function getDayType(dayIndex) {
  return DAY_PATTERN[dayIndex % 7];
}

function getTodayType() {
  const today = new Date().getDay(); // 0=Sun
  const adjusted = today === 0 ? 6 : today - 1; // Mon=0
  return DAY_PATTERN[adjusted];
}

function getTodayKey() {
  const today = new Date().toISOString().split('T')[0];
  return today;
}

function isTodayDone() {
  return !!state.completedDays[getTodayKey()];
}

function getTotalWorkouts() {
  return Object.keys(state.completedDays).length;
}

// ============================================================
// TIMER
// ============================================================
let timerStart = null;
let timerInterval = null;

function startTimer() {
  timerStart = Date.now();
  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - timerStart) / 1000);
    const m = Math.floor(elapsed / 60);
    const s = elapsed % 60;
    document.getElementById('timer-display').textContent = `${m}:${s.toString().padStart(2,'0')}`;
  }, 1000);
}

function resetTimer() {
  clearInterval(timerInterval);
  timerStart = Date.now();
  document.getElementById('timer-display').textContent = '0:00';
  startTimer();
}

// ============================================================
// RENDER
// ============================================================
function renderDashboard() {
  const week = getCurrentWeek();
  const total = getTotalWorkouts();
  const maxWorkouts = 72; // 12*6
  
  document.getElementById('header-week').textContent = `WEEK ${week}`;
  document.getElementById('prog-bar').style.width = `${Math.round((total/maxWorkouts)*100)}%`;
  document.getElementById('stat-workouts').textContent = total;
  document.getElementById('stat-week').textContent = week;
  document.getElementById('stat-streak').textContent = state.streak;

  renderTodayCard();
  renderWeekStrip();
}

function renderTodayCard() {
  const dayType = getTodayType();
  const done = isTodayDone();
  const week = getCurrentWeek();
  const phase = getPhase(week);
  const container = document.getElementById('today-card-container');

  if (dayType === 'rest') {
    container.innerHTML = `<div class="today-card rest">
      <div class="tc-type rest">REST DAY</div>
      <div class="tc-name">Recovery</div>
      <div class="tc-meta">Active recovery, stretching, or complete rest</div>
    </div>`;
    return;
  }

  const labels = { push: 'PUSH DAY', pull: 'PULL DAY', legs: 'LEG DAY' };
  const names = { push: 'Chest Â· Shoulders Â· Triceps', pull: 'Back Â· Biceps Â· Rear Delts', legs: 'Quads Â· Hamstrings Â· Glutes' };
  const config = getSetsReps(dayType, phase);
  const phaseNames = ['Foundation', 'Hypertrophy', 'Intensification'];

  container.innerHTML = `<div class="today-card ${dayType}" onclick="openWorkout('${dayType}')">
    <div class="tc-type ${dayType}">${labels[dayType]}</div>
    <div class="tc-name">${names[dayType]}</div>
    <div class="tc-meta">Week ${week} Â· ${phaseNames[phase]} Â· ${config.sets} sets Ã— ${config.reps} reps</div>
    <div class="tc-meta" style="margin-top:4px">${done ? 'âœ… Completed today' : '7 exercises'}</div>
    ${!done ? `<button class="tc-btn" onclick="event.stopPropagation(); openWorkout('${dayType}')">Start Workout</button>` : ''}
  </div>`;
}

function renderWeekStrip() {
  const strip = document.getElementById('week-strip');
  const week = getCurrentWeek();
  let html = '';
  for (let w = 1; w <= 12; w++) {
    const cls = w < week ? 'done' : w === week ? 'current' : '';
    html += `<div class="week-dot ${cls}">${w}</div>`;
  }
  strip.innerHTML = html;
}

function renderSchedule() {
  const list = document.getElementById('schedule-list');
  let html = '';
  const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
  const dayColors = { push: 'push', pull: 'pull', legs: 'legs', rest: '' };

  PHASES.forEach(phase => {
    html += `<div class="phase-section">
      <div class="phase-title"><span>${phase.name}</span> Â· Weeks ${phase.weeks[0]}â€“${phase.weeks[phase.weeks.length-1]}</div>`;
    
    phase.weeks.forEach(w => {
      const isCurrent = w === getCurrentWeek();
      const isPast = w < getCurrentWeek();
      html += `<div class="week-row ${isCurrent?'current':''} ${isPast?'completed':''}">
        <div class="wr-left">
          <div class="wr-num">WEEK ${w}</div>
          <div class="wr-focus">${phase.focus}</div>
        </div>
        <div class="wr-right">`;
      DAY_PATTERN.forEach((d, i) => {
        html += `<div class="day-pip ${d}" title="${dayNames[i]}: ${d}"></div>`;
      });
      html += `</div></div>`;
    });
    html += '</div>';
  });

  list.innerHTML = html;
}

function renderProgress() {
  const total = getTotalWorkouts();
  const byType = { push: 0, pull: 0, legs: 0 };
  Object.values(state.completedDays).forEach(v => { if (byType[v] !== undefined) byType[v]++; });

  document.getElementById('p-total').textContent = total;
  document.getElementById('p-week').textContent = 'W' + getCurrentWeek();
  document.getElementById('p-push').textContent = byType.push;
  document.getElementById('p-pull').textContent = byType.pull;
  document.getElementById('p-legs').textContent = byType.legs;
  document.getElementById('p-streak').textContent = state.streak;
}

// ============================================================
// WORKOUT
// ============================================================
let currentWorkoutType = null;
let setStates = {}; // exerciseIdx-setIdx => done

function openWorkout(type) {
  currentWorkoutType = type;
  setStates = {};
  
  const week = getCurrentWeek();
  const phase = getPhase(week);
  const config = getSetsReps(type, phase);
  const exercises = EXERCISES[type];
  const names = { push: 'Chest Â· Shoulders Â· Tri', pull: 'Back Â· Biceps', legs: 'Quads Â· Hamstrings' };

  document.getElementById('workout-badge').className = `ws-type-badge ${type}`;
  document.getElementById('workout-badge').textContent = type.toUpperCase();
  document.getElementById('workout-title').textContent = names[type];

  let html = '';
  exercises.forEach((ex, ei) => {
    html += `<div class="exercise-card">
      <div class="ex-header">
        <div>
          <div class="ex-name">${ex.name}</div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px">${ex.muscle}</div>
        </div>
        <div class="ex-num">${String(ei+1).padStart(2,'0')}</div>
      </div>
      <div class="ex-desc">${config.note} Â· ${config.reps} reps Â· Rest 2-3 min</div>
      <div class="sets-grid sets-grid-header">
        <div></div><div>Weight (lbs)</div><div>Reps</div><div></div>
      </div>`;
    
    for (let s = 0; s < config.sets; s++) {
      const key = `${ei}-${s}`;
      html += `<div class="sets-grid" style="margin-top:6px" id="set-row-${ei}-${s}">
        <div class="set-num">${s+1}</div>
        <input class="set-input" type="number" placeholder="â€”" inputmode="decimal" id="weight-${ei}-${s}">
        <input class="set-input" type="number" placeholder="â€”" inputmode="numeric" id="reps-${ei}-${s}">
        <button class="set-check" id="check-${ei}-${s}" onclick="toggleSet(${ei},${s})">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
        </button>
      </div>`;
    }
    html += '</div>';
  });

  document.getElementById('exercise-list').innerHTML = html;

  switchTab('workout', null);
  document.getElementById('screen-workout').scrollTop = 0;

  clearInterval(timerInterval);
  document.getElementById('timer-display').textContent = '0:00';
  startTimer();
}

function toggleSet(ei, si) {
  const key = `${ei}-${si}`;
  setStates[key] = !setStates[key];
  const btn = document.getElementById(`check-${ei}-${si}`);
  btn.classList.toggle('done', setStates[key]);
}

function finishWorkout() {
  clearInterval(timerInterval);
  const elapsed = timerStart ? Math.floor((Date.now() - timerStart) / 1000) : 0;
  const m = Math.floor(elapsed / 60);

  // Mark done
  const key = getTodayKey();
  state.completedDays[key] = currentWorkoutType;
  
  // Update streak
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);
  const yKey = yesterday.toISOString().split('T')[0];
  if (state.lastWorkoutDate === yKey || state.lastWorkoutDate === key) {
    if (state.lastWorkoutDate !== key) state.streak++;
  } else {
    state.streak = 1;
  }
  state.lastWorkoutDate = key;

  // Advance week if we've done enough
  const total = getTotalWorkouts();
  const expectedWeek = Math.min(12, Math.floor(total / 6) + 1);
  state.currentWeek = Math.max(state.currentWeek, expectedWeek);

  saveState();

  const typeEmoji = { push: 'ðŸ’ª', pull: 'ðŸ‹ï¸', legs: 'ðŸ¦µ' };
  showModal(
    typeEmoji[currentWorkoutType] || 'ðŸ”¥',
    'WORKOUT DONE!',
    `${currentWorkoutType.toUpperCase()} day complete! ${m > 0 ? `Duration: ${m} min.` : ''} Rest up and come back stronger.`
  );
}

function showDashboard() {
  clearInterval(timerInterval);
  switchTab('dashboard', document.getElementById('tab-dashboard'));
  renderDashboard();
}

// ============================================================
// NAVIGATION
// ============================================================
function switchTab(tab, btn) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(`screen-${tab}`).classList.add('active');
  if (btn) btn.classList.add('active');

  if (tab === 'schedule') renderSchedule();
  if (tab === 'progress') renderProgress();
  if (tab === 'dashboard') renderDashboard();
}

// ============================================================
// MODAL
// ============================================================
function showModal(icon, title, text, btnText = 'Continue', cb = null) {
  document.getElementById('modal-icon').textContent = icon;
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-text').textContent = text;
  document.getElementById('modal-btn').textContent = btnText;
  modalCallback = cb;
  document.getElementById('modal-overlay').classList.add('show');
}

let modalCallback = null;
function closeModal() {
  document.getElementById('modal-overlay').classList.remove('show');
  if (modalCallback) { modalCallback(); modalCallback = null; }
  showDashboard();
}

function confirmReset() {
  showModal('âš ï¸', 'RESET PROGRESS?', 'This will erase all your workout history and start the 12-week program over from Week 1.', 'Reset Everything', () => {
    state = {
      startDate: new Date().toISOString().split('T')[0],
      completedDays: {},
      currentWeek: 1,
      streak: 0,
      lastWorkoutDate: null,
    };
    saveState();
    renderDashboard();
  });
}

// ============================================================
// INIT
// ============================================================
renderDashboard();
</script>
</body>
</html>
